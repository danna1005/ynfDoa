var curAppClass="";var storage=window.localStorage;var authEkp="";$(document).ready(function(){hadleIndexDetails();fetchIconData();fetchAppAndNews();fetchMailCntData();fetchGuideData();});function isNullOrEmpty(obj){if(obj==null){return true;}else if($.trim(obj)==""){return true;}else if(obj=="undefined"){return true;}else{return false;}}
function fetchAppAndNews(){var lastDateTime=storage.getItem("lastDateTime"),appCategory=storage.getItem("appCategory"),appsList=storage.getItem("appsList"),indexNews=storage.getItem("indexNews");if(!isNullOrEmpty(appCategory)){handleCategores(JSON.parse(appCategory));}
if(!isNullOrEmpty(appsList)){handleAppData(JSON.parse(appsList));}
if(!isNullOrEmpty(indexNews)){handleIndexNews(JSON.parse(indexNews));}
var url;if(!isNullOrEmpty(lastDateTime)&&!isNullOrEmpty(appCategory)&&!isNullOrEmpty(appsList)&&!isNullOrEmpty(indexNews)){url="third/doa/index.do?method=getIndexData"+authEkp+"&lastDataTime="+lastDateTime;}else{url="third/doa/index.do?method=getIndexData"+authEkp+"&lastDataTime=";}
var reqUrl=makeUrl(url);commonGet(reqUrl,null,function(r){if(noError(r)){if(r.errCode==0){if(!isNullOrEmpty(r.data.appCategores)){handleCategores(r.data.appCategores);}
if(!isNullOrEmpty(r.data.apps)){handleAppData(r.data.apps);}
if(!isNullOrEmpty(r.data.indexNews)){handleIndexNews(r.data.indexNews);}
storage.setItem("lastDateTime",r.data.lastDataTime);}}},false);}
function handleCategores(cates){if(!isNullOrEmpty(cates)&&cates.length>0){storage.setItem("appCategory",JSON.stringify(cates));}
var mainHtml="";var subHtml="";for(var i=0;i<cates.length;i++){var item=cates[i];var hash=getHash();var mainClassVal="";if(hash==""&&i==0){mainClassVal="cur";curAppClass=item.name;}else if(item.orderNum==hash){mainClassVal="cur";curAppClass=item.name;if(i>3){$(".detailSelection > .detailPage").css({height:"auto"});$(".addmore-panel").addClass("up").find(".addMoreSer").removeClass("icon-down").addClass("icon-up");}}
mainHtml+=generateMainClassSpan(item.name,item.orderNum,mainClassVal);}
$(".detailContent>.detailSelection>.detailPage").html(mainHtml);}
function handleAppData(apps){if(!isNullOrEmpty(apps)){storage.setItem("appsList",JSON.stringify(apps));}
var appsHtml="";for(var key in apps){var list=apps[key];improveAppIconUrl(list);var curClass=curAppClass==key?"cur":"hidden";var curAppsHtml='<div class="row no-gutter applist '+curClass+'" id="content-'+key+'">                 <div class="selectionContent">';for(var i=0;i<list.length;i++){var item=list[i];var appHtml=geneAppSpan(item.url,item.icon,item.name);curAppsHtml+=appHtml;}
curAppsHtml+="</div></div>";appsHtml+=curAppsHtml;}
$(".detailContent>.appItems").html(appsHtml);}
function handleIndexNews(data){if(!isNullOrEmpty(data)&&data.length>0){storage.setItem("indexNews",JSON.stringify(data));}
var newsHtml="";for(var i=0;i<data.length;i++){var item=data[i];var url=makeUrl(item.url);item.time=getLocalTime(item.time);newsHtml+=generateNewsA(url,item.title,item.pic,item.content,item.time);}
$("#yujiaNews>.newsItems").html(newsHtml);}
function fetchIconData(){var url="third/doa/index.do?method=getIndexCount"+authEkp;var reqUrl=makeUrl(url);commonGet(reqUrl,null,function(r){if(noError(r)){var attenTipNum=r.data.abnormalCnt;var todoTipNum=r.data.sysToDoCount;var dingAttenUrl=r.data.attenURL;storage.setItem("attenUrl",dingAttenUrl);var dingMailUrl=r.data.dingMailUrl;storage.setItem("mailUrl",dingMailUrl);if(parseInt(attenTipNum)>0){showTipNum(0,attenTipNum);var pageUrl="./apps/clock/clock.html";changeUrl(0,pageUrl);}else{changeUrl(0,dingAttenUrl);}
if(parseInt(todoTipNum)>0){showTipNum(1,todoTipNum);}
changeUrl(2,dingMailUrl);}},false);}
function fetchMailCntData(){var myMailCnt="third/mail/coremail/loginCoreMail.do?method=getNotReadMail&s_ajax=true"+authEkp;commonGet(makeUrl(myMailCnt),null,function(r){var tipNum=parseInt(r.num);if(parseInt(tipNum)>0){showTipNum(2,tipNum);}},false);}
function showTipNum(eqNum,tipNum){var strong=$(".commonFn").children("p").eq(eqNum).find("a>span>strong");strong.html(tipNum).removeClass("hidden").addClass("normal");var strongForGuide=$(".commonFn").children("p").eq(eqNum).find("span.apps-highlight>span>strong");strongForGuide.html(tipNum).removeClass("hidden").addClass("normal");}
function changeUrl(eqNum,url){var a=$(".commonFn").children("p").eq(eqNum).find("a");a.attr("href",url);}
function hadleIndexDetails(){var news_more_href=makeUrl("sys/news/mobile/?moduleName=新闻公告");$("#newsMoreHref").attr("href",news_more_href);var attenUrl=storage.getItem("attenUrl"),mailUrl=storage.getItem("mailUrl");if(!isNullOrEmpty(attenUrl)){changeUrl(0,attenUrl);}
if(!isNullOrEmpty(mailUrl)){changeUrl(2,mailUrl);}}
function generateMainClassSpan(name,orderNum,classVal){var span='<span class="'+classVal+'" id="'+name+'" data-hash="'+orderNum+'">                    <b>'+name+"</b>                    <i></i>                </span>";return span;}
function geneSubSpan(name,orderNum,classVal){var p='<p class=" '+classVal+'" data-hash="'+orderNum+'" data-id="'+name+'">                <b>'+name+"</b>                <i></i>             </p>";return p;}
function geneAppSpan(url,icon,name){var html='<span class="col-25">             <a href="'+url+'" calss="a1" data-anchor="'+icon+'" onclick="aListClick(this)">                 <img src='+icon+' alt="#"/>                 <b>'+name+'</b>             </a>             <span class="apps-highlight">                  <img src='+icon+' alt="#"/>                 <b>'+name+"</b>                </span>          </span>";return html;}
function generateNewsA(url,title,img,content,time){if(!img){img="../images/apps/new/leftNews.png";}
var a='<div class="speNews">    <a  href="'+url+'">                 <div class="speNewsLeft">                     <img src="'+img+'" onerror="this.src=\'../images/apps/new/leftNews.png\'">                 </div>                 <div class="speNewsRight">                     <h2>'+title+"</h2>         <p>"+content+'</p>         <span class="newsTime">'+time+'</span>                 </div>        <div class="speNewsBg lastBg"></div>             </a>         </div>';return a;}
var guideRead=storage.getItem("guideRead");function fetchGuideData(){var guideUrl=makeUrl("third/doa/doa_notice/doaNotice.do?method=getNotice&model=index"+authEkp);if(guideRead!=1){commonGet(guideUrl,null,function(r){if(noError(r)){if(r.errCode==0){$(".doa-guide").removeClass("dis-none");$(".index-body").css("overflow","hidden");if(!$(".doa-guide").hasClass("dis-none")){$(".doa-guide").find(".prompt-panel").fadeIn(100);loadGuide(r.data.fdId);}}else{storage.setItem("guideRead",1);$(".index-body").css("overflow","auto");}}},false);}}
function improveAppIconUrl(list){for(var i=0;i<list.length;i++){list[i].icon="../images/index/"+list[i].icon;if(list[i].url=="hr"){list[i].url="javascript:void(0)";}else if(list[i].url&&list[i].url.indexOf("dingtalk")<0&&list[i].id!="add_more"){list[i].url=makeUrl(list[i].url);}}
return list;}
function loadGuide(fdId){$(".prompt-guide>ul>li").each(function(){if($(this).hasClass("cur")){var index=$(this).index();$(".apps-highlight").removeClass("tips");$(".commonFn > p").eq(index).find(".apps-highlight").addClass("tips");var appWidth=$(".commonFn > p").eq(index).find(".apps-highlight").width(),left=$(".commonFn > p").eq(index).find(".apps-highlight")[0].offsetLeft+appWidth;restworkLeft=left-appWidth/3.5;$(".guide-clock").css({left:left/2});$(".guide-restwork").css({left:restworkLeft});$(".guide-email").css({left:left-appWidth/2});$(".guide-server").css({right:left});}});$(".prompt-guide>ul>li").find(".next-step").click(function(){var index=$(this).parent().index();$(".apps-highlight").removeClass("tips");$(this).parent().next().addClass("cur").siblings().removeClass("cur");$(".commonFn > p").eq(index).next().find(".apps-highlight").addClass("tips");if(index==3){$(".selectionContent > span").each(function(){var appPanel=$(this).find("a > b").text();if(appPanel=="我的流程"){$(this).find(".apps-highlight").addClass("tips");}});var appPanel=$(".detailFn").find(".tips").parent(),width=$(".detailFn").find(".tips").width(),height=$(".detailFn").find(".tips").height(),left=appPanel[0].offsetLeft,top=$(".detailFn").find(".tips").parent()[0].offsetTop;$(".guide-process").css({left:left,top:top-height/2});}
$(".guide-page-no").find("span").eq(index).next().addClass("cur").siblings().removeClass("cur");if(index==5){$(".doa-guide").addClass("dis-none").html("");$.ajax({type:"POST",url:makeUrl("third/doa/doa_notice_read/doaNoticeRead.do?method=save"),data:{noticeId:fdId},datatype:"json",success:function(data){storage.setItem("guideRead",1);$(".index-body").css("overflow","auto");},error:function(){}});}});}