$(document).ready(function(){var key="";var searchVue=new Vue({el:"#searchUL",data:{apps:"",flows:"",news:"",keys:""}});if(window.localStorage.searchKeys){searchVue.keys=JSON.parse(window.localStorage.searchKeys);}
$(".search-input").bind("input propertychange",function(){searchEvent();});$(".search-panel .searchPart").tap(function(){var rencentLen=$(".rencent-block").find(".appslist").find("li").length;if(rencentLen<1){$(".rencent-block").addClass("dis-none");}else{$(".rencent-block").removeClass("dis-none");}
$("body").css("overflow","hidden");$.popup(".popup-search");});$(".popup-search").on("click",".close-popup",function(){$("body").css("overflow","auto");});$(document).on("opened",".popup-search",function(){$("#search").val("");setTimeout(function(){$("#search").trigger("click").focus();},1e3);});$(".result-block").on("click","a",function(e){var keysCnt=3;if(window.localStorage.searchKeys){var arr=JSON.parse(window.localStorage.searchKeys);if(arr.length>=keysCnt&&!inArray(key,arr)){arr.pop();arr.unshift(key);}else if(arr.length>=keysCnt&&inArray(key,arr)){arr=toTop(arr,key);}else if(arr.length<keysCnt&&!inArray(key,arr)){arr.unshift(key);}else if(arr.length<keysCnt&&inArray(key,arr)){arr=toTop(arr,key);}
searchVue.keys=arr;window.localStorage.searchKeys=JSON.stringify(arr);}else{var arr=new Array();arr.unshift(key);window.localStorage.searchKeys=JSON.stringify(arr);searchVue.keys=arr;}
$("#search").val("");});$(".appslist").on("click","a",function(e){var curKey=$(this).html();$("#search").val(curKey);searchEvent();});function searchEvent(){var keyWords=$.trim($("#search").val());if(keyWords==""){$(".record-block").removeClass("dis-none");$(".result-block").addClass("dis-none");}else if(keyWords!=key){$(".record-block").addClass("dis-none");key=keyWords;searchData(key);logJsonText("正在搜索"+key);}}
function searchData(key){var url=makeUrl("third/doa/doa_home_search/homeSearch.do?method=search&key="+key);commonGet(url,null,function(r){if(noError(r)){searchVue.apps=r.data.apps;searchVue.news=r.data.news;searchVue.flows=r.data.procedures;logJsonText(searchVue.news);improveUrl(searchVue.apps);improveUrl(searchVue.news);improveUrl(searchVue.flows);if(searchVue.apps.length+searchVue.news.length+searchVue.flows.length>0){showSearchContentBlock();}else{hideSearchContentBlock();}}else{logJsonText(r);}},false);}
function showSearchContentBlock(){$(".result-block").removeClass("dis-none");$(".empty-block").addClass("dis-none");}
function hideSearchContentBlock(){$(".result-block").addClass("dis-none");$(".empty-block").removeClass("dis-none");}
function improveUrl(list){if(list.length>0){for(var i=0;i<list.length;i++){if(list[i].url&&(!list[i].isDingDingApp||list[i].isDingDingApp==false)){list[i].url=makeUrl(list[i].url);}}}}
function inArray(ele,arr){var inArr=false;for(var i=0;i<arr.length;i++){if(ele==arr[i]){inArr=true;break;}}
return inArr;}
function toTop(arr,key){var arrNew=new Array();arrNew.push(key);for(var i=0;i<arr.length;i++){if(arr[i]!=key){arrNew.push(arr[i]);}}
return arrNew;}
var agent=navigator.userAgent.toLowerCase();});